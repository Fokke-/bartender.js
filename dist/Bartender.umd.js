(function(r,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("async-await-queue"),require("ts-debounce")):typeof define=="function"&&define.amd?define(["exports","async-await-queue","ts-debounce"],i):(r=typeof globalThis!="undefined"?globalThis:r||self,i(r.Bartender={},r.asyncAwaitQueue,r.tsDebounce))})(this,function(r,i,n){"use strict";var T=Object.defineProperty;var O=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var y=(r,i,n)=>i in r?T(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,v=(r,i)=>{for(var n in i||(i={}))P.call(i,n)&&y(r,n,i[n]);if(O)for(var n of O(i))$.call(i,n)&&y(r,n,i[n]);return r};var s=(r,i,n)=>(y(r,typeof i!="symbol"?i+"":i,n),n);var d=(r,i,n)=>new Promise((_,c)=>{var b=h=>{try{m(n.next(h))}catch(f){c(f)}},o=h=>{try{m(n.throw(h))}catch(f){c(f)}},m=h=>h.done?_(h.value):Promise.resolve(h.value).then(b,o);m((n=n.apply(r,i)).next())});const _="",c=l=>l?typeof l=="string"?document.querySelector(l):l instanceof Element?l:null:null,b=(l=100)=>new Promise(e=>l?setTimeout(e,l):e());class o extends Error{constructor(e){super(e),this.name="Bartender error"}}class m{constructor(e,t=!0){s(this,"_name","");s(this,"_enabled",!0);s(this,"el");this.el=document.createElement("div"),this.el.classList.add("bartender__overlay"),this.name=e,this.enabled=t}get name(){return this._name}set name(e){this.el.classList.remove(`bartender__overlay--${this._name}`),this.el.classList.add(`bartender__overlay--${e}`),this._name=e}get enabled(){return this._enabled}set enabled(e){e===!0?this.el.classList.remove("bartender__overlay--transparent"):this.el.classList.add("bartender__overlay--transparent"),this._enabled=e}show(){return this.el.classList.add("bartender__overlay--visible"),this}hide(){return this.el.classList.remove("bartender__overlay--visible"),this}}class h{constructor(e,t={}){s(this,"overlayObj");s(this,"_name","");s(this,"el");s(this,"_position","left");s(this,"_mode","float");s(this,"_overlay",!0);s(this,"permanent",!1);s(this,"scrollTop",!0);s(this,"isOpened",!1);var u,p,w,g,E;if(!e)throw"Bar name is required";this.overlayObj=new m(e,this.overlay),this.name=e;const a=c(t.el||null);if(!a)throw new o(`Content element for bar '${this.name}' is required`);this.el=a,this.el.classList.add("bartender__bar"),this.position=(u=t.position)!=null?u:this.position,this.mode=(p=t.mode)!=null?p:this._mode,this.overlay=(w=t.overlay)!=null?w:this._overlay,this.permanent=(g=t.permanent)!=null?g:this.permanent,this.scrollTop=(E=t.scrollTop)!=null?E:this.scrollTop}get name(){return this._name}set name(e){this._name=e,this.overlayObj.name=e}get position(){return this._position}set position(e){if(!e)throw`Position is required for bar '${this.name}'`;const t=["left","right","top","bottom"];if(!t.includes(e))throw`Invalid position '${e}' for bar '${this.name}'. Use one of the following: ${t.join(", ")}.`;this.el&&(this.el.style.transition="none"),this.el.classList.remove(`bartender__bar--${this.position}`),this.el.classList.add(`bartender__bar--${e}`),this._position=e,setTimeout(()=>{this.el&&(this.el.style.transition="")})}get mode(){return this._mode}set mode(e){if(!e)throw`Mode is required for bar '${this.name}'`;const t=["float","push","reveal"];if(!t.includes(e))throw`Invalid mode '${e}' for bar '${this.name}'. Use one of the following: ${t.join(", ")}.`;this.el.classList.remove(`bartender__bar--${this.mode}`),this.el.classList.add(`bartender__bar--${e}`),this._mode=e}get overlay(){return this._overlay}set overlay(e){this.overlayObj.enabled=e,this._overlay=e}isOpen(){return this.isOpened}getTransitionDuration(){if(!this.el)return 0;const e=window.getComputedStyle(this.el).getPropertyValue("transition-duration")||"0s";return parseFloat(e)*1e3}open(){return d(this,null,function*(){return this.el.dispatchEvent(new CustomEvent("bartender-bar-before-open",{bubbles:!0,detail:{bar:this}})),this.scrollTop===!0&&this.el.scrollTo(0,0),this.el.classList.add("bartender__bar--open"),this.overlayObj.show(),this.isOpened=!0,yield b(this.getTransitionDuration()),this.el.dispatchEvent(new CustomEvent("bartender-bar-after-open",{bubbles:!0,detail:{bar:this}})),Promise.resolve(this)})}close(){return d(this,null,function*(){return this.el.dispatchEvent(new CustomEvent("bartender-bar-before-close",{bubbles:!0,detail:{bar:this}})),this.el.classList.remove("bartender__bar--open"),this.overlayObj.hide(),this.isOpened=!1,yield b(this.getTransitionDuration()),this.el.dispatchEvent(new CustomEvent("bartender-bar-after-close",{bubbles:!0,detail:{bar:this}})),Promise.resolve(this)})}getPushStyles(){return!this.position||!this.el?{transform:"",transitionDuration:"",transitionTimingFunction:""}:{transform:{left:`translateX(${this.el.offsetWidth}px)`,right:`translateX(-${this.el.offsetWidth}px)`,top:`translateY(${this.el.offsetHeight}px)`,bottom:`translateY(-${this.el.offsetHeight}px)`}[this.position]||"",transitionDuration:window.getComputedStyle(this.el).getPropertyValue("transition-duration")||"",transitionTimingFunction:window.getComputedStyle(this.el).getPropertyValue("transition-timing-function")||""}}}class f{constructor(e={}){s(this,"el");s(this,"bars");s(this,"modes");s(this,"isPushed",!1);const t=c(e.el||null);if(!t)throw new o("Element is required for push element");this.el=t,this.bars=e.bars||[],this.modes=e.modes||[]}push(e,t){return this.bars.length&&!this.bars.includes(e)?this:this.modes.length&&!this.modes.includes(e.mode)?this:(this.el.style.transform=t.transform,this.el.style.transitionTimingFunction=t.transitionTimingFunction,this.el.style.transitionDuration=t.transitionDuration,this.isPushed=!0,this)}pull(){return this.isPushed===!1?this:(this.el.style.transform="translateX(0) translateY(0)",this)}}class B{constructor(e={},t={}){s(this,"queue");s(this,"resizeDebounce");s(this,"debug",!1);s(this,"el");s(this,"contentEl");s(this,"switchTimeout",150);s(this,"bars",[]);s(this,"pushableElements",[]);s(this,"barDefaultOptions",{el:null,position:"left",mode:"float",overlay:!0,permanent:!1,scrollTop:!0});var p,w;this.debug=(p=e.debug)!=null?p:this.debug,this.switchTimeout=(w=e.switchTimeout)!=null?w:this.switchTimeout,this.barDefaultOptions=Object.assign(this.barDefaultOptions,t);const a=c(e.el||".bartender");if(!a)throw new o("Main element is required");this.el=a;const u=c(e.contentEl||".bartender__content");if(!u)throw new o("Content element is required");if(u.parentElement!==this.el)throw new o("Content element must be a direct child of the main element");this.contentEl=u,this.addPushElement({el:this.contentEl,modes:["push","reveal"]}),this.queue=new i.Queue(1),this.resizeDebounce=n.debounce(()=>{this.pushElements(this.getOpenBar())},100),window.addEventListener("keydown",this.onKeydown.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),this.el.classList.add("bartender--ready"),this.el.dispatchEvent(new CustomEvent("bartender-init",{bubbles:!0,detail:{bartender:this}}))}destroy(){this.el.classList.remove("bartender--ready")}getBar(e){return this.bars.find(t=>t.name===e)||null}getOpenBar(){return this.bars.find(e=>e.isOpen()===!0)||null}addBar(e,t={}){var u;if(!e||typeof e!="string")throw new o("Name is required");if(this.getBar(e))throw new o(`Bar with name '${e}' is already defined`);const a=new h(e,v(v({},this.barDefaultOptions),t));return(u=this.contentEl)==null||u.appendChild(a.overlayObj.el),a.overlayObj.el.addEventListener("click",()=>{a.permanent!==!0&&this.close()}),this.bars.push(a),this.el.dispatchEvent(new CustomEvent("bartender-bar-added",{bubbles:!0,detail:{bar:a}})),a}openBar(e){return d(this,null,function*(){const t=this.getBar(e);return t?t.isOpen()===!0?Promise.resolve(t):(this.getOpenBar()&&(yield this.closeBar(!1),yield b(this.switchTimeout)),this.el.classList.add("bartender--open"),this.pushElements(t),t.open()):Promise.reject(new o(`Unknown bar '${e}'`))})}open(e){return d(this,null,function*(){const t=Symbol();return yield this.queue.wait(t),this.openBar(e).finally(()=>{this.queue.end(t)})})}closeBar(e=!0){return d(this,null,function*(){const t=this.getOpenBar();return t?(this.pullElements(),yield t.close(),e===!0&&this.el.classList.remove("bartender--open"),Promise.resolve(t)):Promise.resolve(null)})}close(){return d(this,null,function*(){const e=Symbol();return yield this.queue.wait(e),this.closeBar().finally(()=>{this.queue.end(e)})})}toggle(e){return d(this,null,function*(){const t=this.getBar(e);return t?t.isOpen()===!0?this.close():this.open(e):Promise.reject(new o(`Unknown bar '${e}'`))})}addPushElement(e={}){const t=new f(e);return this.pushableElements.push(t),t}pushElements(e){if(!e||!this.pushableElements.length)return this.pushableElements;const t=e.getPushStyles();for(const a of this.pushableElements)a.push(e,t);return this.pushableElements}pullElements(){this.pushableElements.length||this.pushableElements;for(const e of this.pushableElements)e.pull();return this.pushableElements}onKeydown(e){if(e.key==="Escape"){const t=this.getOpenBar();if(!t||t.permanent===!0)return;this.close()}}onResize(){this.resizeDebounce()}}r.Bartender=B,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
