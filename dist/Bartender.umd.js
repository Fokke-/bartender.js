(function(h,a){typeof exports=="object"&&typeof module!="undefined"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(h=typeof globalThis!="undefined"?globalThis:h||self,a(h.Bartender={}))})(this,function(h){"use strict";var P=Object.defineProperty;var _=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var v=(h,a,r)=>a in h?P(h,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[a]=r,E=(h,a)=>{for(var r in a||(a={}))O.call(a,r)&&v(h,r,a[r]);if(_)for(var r of _(a))B.call(a,r)&&v(h,r,a[r]);return h};var n=(h,a,r)=>(v(h,typeof a!="symbol"?a+"":a,r),r);var d=(h,a,r)=>new Promise((b,p)=>{var w=c=>{try{m(r.next(c))}catch(f){p(f)}},g=c=>{try{m(r.throw(c))}catch(f){p(f)}},m=c=>c.done?b(c.value):Promise.resolve(c.value).then(w,g);m((r=r.apply(h,a)).next())});const a="",r=(u,e)=>{if(u instanceof HTMLElement)return u;if(typeof e=="string")return document.querySelector(e)||void 0},b=(u=100)=>new Promise(e=>u?setTimeout(e,u):e());class p extends Error{constructor(e){super(e),this.name="Bartender error"}}class w{constructor(e,t=!0){n(this,"_name","");n(this,"_enabled",!0);n(this,"el");this.el=document.createElement("div"),this.el.classList.add("bartender__overlay"),this.name=e,this.enabled=t}get name(){return this._name}set name(e){this.el.classList.remove(`bartender__overlay--${this._name}`),this.el.classList.add(`bartender__overlay--${e}`),this._name=e}get enabled(){return this._enabled}set enabled(e){e===!0?this.el.classList.remove("bartender__overlay--disabled"):this.el.classList.add("bartender__overlay--disabled"),this._enabled=e}show(){return this.el.classList.add("bartender__overlay--visible"),this}hide(){return this.el.classList.remove("bartender__overlay--visible"),this}}class g{constructor(e,t={}){n(this,"overlayObj");n(this,"_name","");n(this,"el");n(this,"_position","left");n(this,"_mode","float");n(this,"_overlay",!0);n(this,"permanent",!1);n(this,"isOpened",!1);var i,s,o,l;if(!e)throw"Bar name is required";if(this.overlayObj=new w(e,this.overlay),this.name=e,this.el=r(t.el,t.elSelector),!this.el)throw new p(`Content element for bar '${this.name}' is required`);this.el.classList.add("bartender__bar"),this.mode=(i=t.mode)!=null?i:this._mode,this.position=(s=t.position)!=null?s:this.position,this.overlay=(o=t.overlay)!=null?o:this._overlay,this.permanent=(l=t.permanent)!=null?l:this.permanent}get name(){return this._name}set name(e){this._name=e,this.overlayObj.name=e}get position(){return this._position}set position(e){var i,s;if(!e)throw`Position is required for bar '${this.name}'`;const t=["left","right","top","bottom"];if(!t.includes(e))throw`Invalid position '${e}' for bar '${this.name}'. Use one of the following: ${t.join(", ")}.`;this.el&&(this.el.style.transition="none"),(i=this.el)==null||i.classList.remove(`bartender__bar--${this.position}`),(s=this.el)==null||s.classList.add(`bartender__bar--${e}`),this._position=e,setTimeout(()=>{this.el&&(this.el.style.transition="")})}get mode(){return this._mode}set mode(e){var i,s;if(!e)throw`Mode is required for bar '${this.name}'`;const t=["float","push","reveal"];if(!t.includes(e))throw`Invalid mode '${e}' for bar '${this.name}'. Use one of the following: ${t.join(", ")}.`;(i=this.el)==null||i.classList.remove(`bartender__bar--${this.mode}`),(s=this.el)==null||s.classList.add(`bartender__bar--${e}`),this._mode=e}get overlay(){return this._overlay}set overlay(e){this.overlayObj.enabled=e,this._overlay=e}isOpen(){return this.isOpened}isPushing(){return["push","reveal"].includes(this.mode)}getTransitionDuration(){if(!this.el)return 0;const e=window.getComputedStyle(this.el).getPropertyValue("transition-duration")||"0s";return parseFloat(e)*1e3}open(){return d(this,null,function*(){var e,t,i;return(e=this.el)==null||e.dispatchEvent(new CustomEvent("bartender-bar-before-open",{bubbles:!0,detail:{bar:this}})),(t=this.el)==null||t.classList.add("bartender__bar--open"),this.isOpened=!0,yield b(this.getTransitionDuration()),(i=this.el)==null||i.dispatchEvent(new CustomEvent("bartender-bar-after-open",{bubbles:!0,detail:{bar:this}})),Promise.resolve(this)})}close(){return d(this,null,function*(){var e,t,i;return(e=this.el)==null||e.dispatchEvent(new CustomEvent("bartender-bar-before-close",{bubbles:!0,detail:{bar:this}})),(t=this.el)==null||t.classList.remove("bartender__bar--open"),this.isOpened=!1,yield b(this.getTransitionDuration()),(i=this.el)==null||i.dispatchEvent(new CustomEvent("bartender-bar-after-close",{bubbles:!0,detail:{bar:this}})),Promise.resolve(this)})}getPushStyles(){return!this.position||!this.el?null:{transform:{left:`translateX(${this.el.offsetWidth}px)`,right:`translateX(-${this.el.offsetWidth}px)`,top:`translateY(${this.el.offsetHeight}px)`,bottom:`translateY(-${this.el.offsetHeight}px)`}[this.position]||"",transitionDuration:window.getComputedStyle(this.el).getPropertyValue("transition-duration")||"",transitionTimingFunction:window.getComputedStyle(this.el).getPropertyValue("transition-timing-function")||""}}}class m{constructor(e){this.compare=e,this.heapArray=[],this._limit=0}static getChildrenIndexOf(e){return[2*e+1,2*e+2]}static getParentIndexOf(e){if(e<=0)return-1;const t=e%2?1:2;return Math.floor((e-t)/2)}push(e){return this._sortNodeUp(this.heapArray.push(e)-1),!0}length(){return this.heapArray.length}peek(){return this.heapArray[0]}pop(){const e=this.heapArray.pop();return this.length()>0&&e!==void 0?this.replace(e):e}replace(e){const t=this.heapArray[0];return this.heapArray[0]=e,this._sortNodeDown(0),t}size(){return this.length()}_moveNode(e,t){[this.heapArray[e],this.heapArray[t]]=[this.heapArray[t],this.heapArray[e]]}_sortNodeDown(e){let t=e<this.heapArray.length-1;const i=this.heapArray[e],s=(o,l)=>(this.heapArray.length>l&&this.compare(this.heapArray[l],this.heapArray[o])<0&&(o=l),o);for(;t;){const o=m.getChildrenIndexOf(e),l=o.reduce(s,o[0]),y=this.heapArray[l];y!==void 0&&this.compare(i,y)>0?(this._moveNode(e,l),e=l):t=!1}}_sortNodeUp(e){let t=e>0;for(;t;){const i=m.getParentIndexOf(e);i>=0&&this.compare(this.heapArray[i],this.heapArray[e])>0?(this._moveNode(e,i),e=i):t=!1}}}function c(u,e){return u.prio-e.prio||u.counter-e.counter}class f{constructor(e,t){this.maxConcurrent=e||1,this.minCycle=t||0,this.queueRunning=new Map,this.queueWaiting=new m(c),this.lastRun=0,this.nextTimer=null,this.counter=0}tryRun(){for(;this.queueWaiting.size()>0&&this.queueRunning.size<this.maxConcurrent;){if(Date.now()-this.lastRun<this.minCycle)return void(this.nextTimer===null&&(this.nextTimer=new Promise(t=>setTimeout(()=>{this.nextTimer=null,this.tryRun(),t()},this.minCycle-Date.now()+this.lastRun))));const e=this.queueWaiting.pop();if(e!==void 0){let t;const i={wait:new Promise(o=>{t=o}),signal:t},s={hash:e.hash,prio:e.prio,finish:i};if(this.queueRunning.has(e.hash))throw new Error("async-await-queue: duplicate hash "+e.hash);this.queueRunning.set(e.hash,s),this.lastRun=Date.now(),e.start.signal()}}}end(e){const t=this.queueRunning.get(e);if(t===void 0)throw new Error("async-await-queue: queue desync for "+e);this.queueRunning.delete(e),t.finish.signal(),this.tryRun()}wait(e,t){return d(this,null,function*(){const i=t!=null?t:0;let s;const o=new Promise(y=>{s=y}),l={hash:e,prio:i,start:{signal:s,wait:o},counter:this.counter++};this.queueWaiting.push(l),this.tryRun(),yield o,this.lastRun=Date.now()})}run(e,t){const i=t!=null?t:0,s=Symbol();return this.wait(s,i).then(e).finally(()=>{this.end(s)})}stat(){return{running:this.queueRunning.size,waiting:this.queueWaiting.size(),last:this.lastRun}}flush(e){return d(this,null,function*(){for(;this.queueRunning.size>0||this.queueWaiting.size()>0;){const t=this.queueWaiting.peek();if(t&&(yield t.start.wait),e!==void 0&&this.queueWaiting.size()<e)return;this.queueRunning.size>0&&(yield this.queueRunning.values().next().value.finish.wait)}})}}class q{constructor(e={},t={}){n(this,"queue");n(this,"debug",!1);n(this,"mainEl");n(this,"mainElSelector",".bartender");n(this,"contentEl");n(this,"contentElSelector",".bartender__content");n(this,"switchTimeout",150);n(this,"bars",[]);n(this,"pushableElements",[]);n(this,"barOptions",{position:"left",mode:"float",permanent:!1});var i,s,o,l;if(this.debug=(i=e.debug)!=null?i:this.debug,this.mainElSelector=(s=e.mainElSelector)!=null?s:this.mainElSelector,this.contentElSelector=(o=e.contentElSelector)!=null?o:this.contentElSelector,this.switchTimeout=(l=e.switchTimeout)!=null?l:this.switchTimeout,this.barOptions=Object.assign(this.barOptions,t),this.mainEl=r(e.mainEl,this.mainElSelector),!this.mainEl)throw new p("Main element is required");if(this.contentEl=r(e.contentEl,this.contentElSelector),!this.contentEl)throw new p("Content element is required");if(this.addPushElement({el:this.contentEl}),this.contentEl.parentElement!==this.mainEl)throw new p("Content element must be a direct child of the main element");this.queue=new f(1),window.addEventListener("keydown",this.handleKeydown.bind(this)),this.mainEl.classList.add("bartender--ready"),this.mainEl.dispatchEvent(new CustomEvent("bartender-init",{bubbles:!0,detail:{bartender:this}}))}destroy(){var e;(e=this.mainEl)==null||e.classList.remove("bartender--ready")}getBar(e){return this.bars.find(t=>t.name===e)||null}getOpenBar(){return this.bars.find(e=>e.isOpen()===!0)||null}addBar(e,t={}){var o,l;if(!e||typeof e!="string")return Promise.reject(new Error("Name is required"));if(this.getBar(e))return Promise.reject(new Error(`Bar with name '${e}' is already defined`));const i=E(E({},this.barOptions),t),s=new g(e,i);return(o=this.contentEl)==null||o.appendChild(s.overlayObj.el),s.overlayObj.el.addEventListener("click",()=>{s.permanent!==!0&&this.close()}),this.bars.push(s),(l=this.mainEl)==null||l.dispatchEvent(new CustomEvent("bartender-bar-added",{bubbles:!0,detail:{bar:s}})),Promise.resolve(s)}openBar(e){return d(this,null,function*(){var i;const t=this.getBar(e);return t?t.isOpen()===!0?Promise.resolve(t):(this.getOpenBar()&&(yield this.closeBar(!1),yield b(this.switchTimeout)),(i=this.mainEl)==null||i.classList.add("bartender--open"),t.overlayObj.show(),t.isPushing()===!0&&(yield this.pushElements(t.getPushStyles())),t.open()):Promise.reject(new Error(`Unknown bar '${e}'`))})}open(e){return d(this,null,function*(){const t=Symbol();return yield this.queue.wait(t),this.openBar(e).finally(()=>{this.queue.end(t)})})}closeBar(e=!0){return d(this,null,function*(){var i;const t=this.getOpenBar();return t?(this.pullElements(),t.overlayObj.hide(),yield t.close(),e===!0&&((i=this.mainEl)==null||i.classList.remove("bartender--open")),Promise.resolve(t)):Promise.resolve(null)})}close(){return d(this,null,function*(){const e=Symbol();return yield this.queue.wait(e),this.closeBar().finally(()=>{this.queue.end(e)})})}toggle(e){return d(this,null,function*(){const t=this.getBar(e);return t?t.isOpen()===!0?this.close():this.open(e):Promise.reject(new Error(`Unknown bar '${e}'`))})}addPushElement(e={}){const t=r(e.el,e.elSelector);return t?(this.pushableElements.push(t),Promise.resolve(t)):Promise.reject(new Error("Unknown push element"))}pushElements(e){return new Promise(t=>{if(!e||!this.pushableElements.length)return t(this.pushableElements);for(const i of this.pushableElements)i.style.transform=e.transform,i.style.transitionDuration=e.transitionDuration,i.style.transitionTimingFunction=e.transitionTimingFunction;return t(this.pushableElements)})}pullElements(){return new Promise(e=>{if(!this.pushableElements.length)return Promise.resolve(this.pushableElements);for(const t of this.pushableElements)t.style.transform="translateX(0) translateY(0)";return e(this.pushableElements)})}handleKeydown(e){if(e.key==="Escape"){const t=this.getOpenBar();if(!t||t.permanent===!0)return;this.close()}}}h.Bartender=q,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
